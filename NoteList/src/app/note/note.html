<div class="note-container">
  <div *ngIf="loading" class="loading">
    Loading note...
  </div>
  
  <div *ngIf="!loading && !note" class="error">
    Note not found.
  </div>
  
  <div *ngIf="!loading && note" class="note-content">
    <div class="header">
      <h1>{{ note.title }}</h1>
      <div class="header-actions">
        <button [routerLink]="['/notes']" class="back-btn-header">
          Back
        </button>
      </div>
    </div>

    <div class="note-header">
      <p *ngIf="note.description && note.description.trim()" class="note-description">{{ note.description }}</p>
      <div class="note-meta">
        <div class="note-categories">
          <span *ngFor="let category of note.categories" 
                class="category-tag"
                [style.background-color]="getCategoryColor(category)">
            {{ category }}
          </span>
        </div>
        <p class="note-date">Created: {{ formatDate(note.created_at) }}</p>
      </div>
    </div>
    
    <div class="note-image" *ngIf="note.img">
      <img [src]="note.img" [alt]="note.title" loading="lazy" />
      <div class="image-actions">
        <button (click)="downloadImage()" class="download-image-btn" title="Download image">
          <svg class="download-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7,10 12,15 17,10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Download
        </button>
      </div>
    </div>
    
    <div *ngIf="note.content" class="note-body">
      <div class="content-with-lines" 
           [class.show-line-numbers]="showLineNumbers"
           [style.--line-number-width.px]="getLineNumberWidth()"
           [style.--content-padding-left.px]="getContentPaddingLeft()">
        <div class="content-text">
          <div *ngFor="let line of getContentLines(); let i = index" 
               class="content-line"
               [class.with-copy-buttons]="showCopyButtons"
               (mouseenter)="showCopyButtons && line.trim() ? showCopyButton(i) : null"
               (mouseleave)="showCopyButtons && line.trim() ? hideCopyButton(i) : null">{{ line }}<button 
               *ngIf="showCopyButtons && hoveredLineIndex === i && line.trim()" 
               class="copy-line-btn" 
               (click)="copyLineToClipboard(line, $event)" 
               title="Copy line">
               <img src="../../assets/copy.svg" alt="Copy" class="copy-icon">
              </button>
            </div>
        </div>
      </div>
    </div>
    
    <div class="note-actions">
      <button [routerLink]="['/note-form', note.id]" class="edit-btn">Edit</button>
      <button [routerLink]="['/notes']" class="back-btn">Back to Notes</button>
    </div>
  </div>
</div>