<div class="notes-container">
  <div class="header">
    <h1>My Notes</h1>
    <div class="header-actions">
      <button [routerLink]="['/note-form']" class="add-btn">+ Add Note</button>
      <button [routerLink]="['/categories']" class="manage-categories-btn">Manage Categories</button>
      <button [routerLink]="['/settings']" class="settings-btn" title="Settings">
        <img src="../../assets/settings.svg" alt="Settings" class="icon-svg">
      </button>
      <button (click)="refreshNotes()" class="refresh-btn" title="Refresh">
        <img src="../../assets/refresh.svg" alt="Refresh" class="icon-svg">
      </button>
    </div>
  </div>
  
  <div *ngIf="shouldShowActiveFilters()" class="active-filters">
    <span class="filters-label">Active filters:</span>
    <span *ngIf="searchTerm" class="filter-tag search-tag">
      Search: "{{ searchTerm }}"
      <button (click)="clearSearch()" class="remove-filter">×</button>
    </span>
    <span *ngFor="let category of selectedCategories" class="filter-tag category-tag" 
          [style.background-color]="getCategoryColor(category)">
      {{ category }}
      <button (click)="toggleCategory(category)" class="remove-filter">×</button>
    </span>
  </div>

  <div class="search-filter-container">
    <div class="search-notes">
      <div class="search-input-container">
        <input 
          id="search"
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          placeholder="Search notes by title or description..."
          class="search-input"
          name="noteSearch">
        <button 
          *ngIf="searchTerm" 
          (click)="clearSearch()" 
          type="button"
          class="clear-search-btn">
          ×
        </button>
      </div>
      <button (click)="toggleCategoryFilter()" class="filter-btn" [title]="showCategoryFilter ? 'Hide Filters' : 'Show Filters'">
        <span>Filters</span>
        <span class="filter-arrow" [class.expanded]="showCategoryFilter">▼</span>
      </button>
    </div>

    <div class="category-filter" [class.expanded]="showCategoryFilter">
      <h3>Filter by Categories:</h3>
      
      <div *ngIf="allCategories.length > 0; else noCategoriesTemplate">
        <div class="category-buttons">
          <button 
            *ngFor="let category of allCategories" 
            (click)="toggleCategory(category)"
            [class.active]="isCategoryActive(category)"
            [style.--category-bg-color]="getCategoryColor(category)"
            class="category-btn">
            <span class="category-color" [style.background-color]="getCategoryColor(category)"></span>
            {{ category }}
          </button>
        </div>
        <div class="filter-actions">
          <button (click)="clearFilters()" class="clear-btn">Clear All Filters</button>
          <span class="selected-count" *ngIf="selectedCategories.length > 0">
            Selected: {{ selectedCategories.length }}
          </span>
        </div>
      </div>

      <ng-template #noCategoriesTemplate>
        <div class="no-categories-message">
          <p>No categories available yet.</p>
          <p>Create categories in <a [routerLink]="['/categories']" class="create-categories-link">Manage Categories</a> to filter your notes.</p>
        </div>
      </ng-template>
    </div>
  </div>
  
  <div *ngIf="loading" class="loading">
    Loading notes...
  </div>
  
  <div *ngIf="!loading && notes.length === 0" class="empty-state">
    <p *ngIf="selectedCategories.length === 0">No notes found.</p>
    <p *ngIf="selectedCategories.length > 0">No notes found in selected categories.</p>
  </div>
  
  <div *ngIf="!loading && notes.length > 0" class="notes-list">
    <div *ngFor="let note of notes; let i = index" class="note-item" [routerLink]="['/note', note.id]">
      <div class="note-image" *ngIf="note.img">
        <img [src]="note.img" [alt]="note.title" loading="lazy" />
      </div>
      <div class="note-content">
        <h3>{{ note.title }}</h3>
        <p class="note-description">{{ note.description }}</p>
        <div class="note-categories">
          <span *ngFor="let category of note.categories" 
                class="category-tag"
                [style.background-color]="getCategoryColor(category)"
                [style.color]="'white'">
            {{ category }}
          </span>
        </div>
        <p *ngIf="shouldShowCreationDates()" class="note-date">{{ formatDate(note.created_at) }}</p>
      </div>
      <div class="note-position-controls">
        <button 
          class="position-btn" 
          title="Move up"
          [disabled]="i === 0"
          (click)="moveNoteUp(i, $event)">
          ▲
        </button>
        <button 
          class="position-btn" 
          title="Move down"
          [disabled]="i === notes.length - 1"
          (click)="moveNoteDown(i, $event)">
          ▼
        </button>
      </div>
    </div>
  </div>
</div>
