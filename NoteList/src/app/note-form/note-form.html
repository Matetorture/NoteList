<div class="note-form-container">
  <div class="header">
    <h1>{{ isEditMode ? 'Edit Note' : 'Create New Note' }}</h1>
    <div class="header-actions">
      <button type="button" (click)="goBack()" class="cancel-btn">
        Back
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="loading">
    Loading...
  </div>

  <form *ngIf="!loading" (ngSubmit)="saveNote()" class="note-form">
    <div class="form-group">
      <label for="title">Title *</label>
      <input 
        id="title"
        [(ngModel)]="note.title" 
        name="title"
        required 
        class="form-input"
        placeholder="Enter note title">
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <input 
        id="description"
        [(ngModel)]="note.description" 
        name="description"
        class="form-input"
        placeholder="Short description">
    </div>

    <div class="form-group">
      <label for="imageFile">Image</label>
      <div class="image-input-container">
        <div *ngIf="note.img" class="image-preview">
          <img [src]="note.img" [alt]="note.title || 'Note image'" />
          <div class="image-info">
            <small *ngIf="selectedImageFile">
              {{ selectedImageFile.name }} ({{ (selectedImageFile.size / 1024 / 1024).toFixed(2) }}MB)
            </small>
          </div>
        </div>
        
        <div class="image-buttons-row">
          <button 
            type="button"
            class="file-picker-btn"
            (click)="triggerFileInput()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7,10 12,15 17,10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Choose Image File
          </button>
          
          <button 
            *ngIf="note.img" 
            type="button" 
            (click)="clearImage()" 
            class="clear-image-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            Remove Image
          </button>
        </div>
        
        <small class="file-info">Supports JPG, PNG, GIF, WebP (max 5MB)</small>
        
        <input 
          id="imageFile"
          type="file"
          accept="image/*"
          (change)="onImageFileSelected($event)"
          class="form-file-input"
          style="display: none;">
      </div>
    </div>

    <div class="form-group">
      <label for="content">Content</label>
      <textarea 
        id="content"
        [(ngModel)]="note.content" 
        name="content"
        class="form-textarea"
        [style.height.px]="contentTextareaHeight"
        placeholder="Write your note content here...">
      </textarea>
    </div>

    <div class="form-group">
      <label>Categories 
        <span class="selected-count" *ngIf="note.categories.length > 0">
          ({{ note.categories.length }} selected)
        </span>
      </label>
      
      <!-- Category Search -->
      <div class="category-search" *ngIf="availableCategories.length > 3">
        <div class="search-input-container">
          <input 
            [(ngModel)]="categorySearchTerm"
            (input)="onCategorySearch()"
            placeholder="Search categories..."
            class="category-search-input"
            name="categorySearch">
          <button 
            *ngIf="categorySearchTerm" 
            (click)="clearCategorySearch()" 
            type="button"
            class="clear-search-btn">
            Ã—
          </button>
        </div>
        <small class="search-info">
          Showing {{ filteredCategories.length }} of {{ availableCategories.length }} categories
        </small>
      </div>
      
      <div class="categories-selection">
        <div 
          *ngFor="let category of filteredCategories" 
          class="category-option"
          (click)="toggleCategory(category.name)"
          [class.selected]="isCategorySelected(category.name)"
          [class.unselected]="!isCategorySelected(category.name)"
          [style.background-color]="category.color">
          {{ category.name }}
        </div>
      </div>
      
      <div *ngIf="filteredCategories.length === 0 && categorySearchTerm" class="no-categories-found">
        No categories found for "{{ categorySearchTerm }}"
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" [disabled]="saving" class="save-btn">
        {{ saving ? 'Saving...' : 'Save Note' }}
      </button>
      
      <button type="button" (click)="goBack()" class="cancel-btn">
        Cancel
      </button>
      
      <button 
        *ngIf="isEditMode" 
        type="button" 
        (click)="deleteNote()" 
        class="delete-btn">
        Delete Note
      </button>
    </div>
  </form>
</div>